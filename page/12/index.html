<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    
    <title>程序员小明 | Java | Spring Boot | Spring Cloud | ElasticSearch |日常开发 |最新干货分享</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    

    

    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1.13.0.css">


    <script>
        window.isPost = false
        window.aomori = {
            
        }
        window.aomori_logo_typed_animated = true
        window.aomori_search_algolia = false
    </script>

<meta name="generator" content="Hexo 5.3.0"></head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-inner">
                
                    <div id="typed-strings" style="display:none">
                        <p>程序员小明 | Java | Spring Boot | Spring Cloud | ElasticSearch |日常开发 |最新干货分享</p>
                    </div>
                    <a class="header-type-title" id="typed" href="/"></a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
                <a href="/">Home</a>
                
                <a href="/archives">Archives</a>
                
            </div>
            <div class="header-menu-social">
                
            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                    <a href="/">Home</a>
                    
                    <a href="/archives">Archives</a>
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="index">
  
    
      <article
  id="post-mysql常用操作"
  class="article article-type-post"
>

  

  <div class="article-inner">
    

    <div class="article-body">
      <header class="article-title">
        <a href="/p/72bf.html">mysql常用操作</a>
      </header>
      <div class="article-entry post-inner-html">
        
          <h2 id="查询数据库所有的表"><a href="#查询数据库所有的表" class="headerlink" title="查询数据库所有的表"></a>查询数据库所有的表</h2><p>（用逗号隔开）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAt( table_name ) FROM information_schema.TABLES WHERE table_schema &#x3D; &#39;数据库名&#39; AND table_type &#x3D; &#39;base table&#39;;</span><br></pre></td></tr></table></figure>
<h2 id="查询数据库中某张表所有的字段"><a href="#查询数据库中某张表所有的字段" class="headerlink" title="查询数据库中某张表所有的字段"></a>查询数据库中某张表所有的字段</h2><p>（用逗号隔开）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT( column_name ) FROM information_schema.COLUMNS WHERE table_name &#x3D; &#39;表名&#39;;</span><br></pre></td></tr></table></figure>
<h2 id="计算两个经纬度之间的距离-lon经度，lat纬度"><a href="#计算两个经纬度之间的距离-lon经度，lat纬度" class="headerlink" title="计算两个经纬度之间的距离,lon经度，lat纬度"></a>计算两个经纬度之间的距离,lon经度，lat纬度</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE DEFINER&#x3D;&#96;lkhd&#96;@&#96;%&#96; FUNCTION &#96;func_distance&#96;( </span><br><span class="line">lon1 DOUBLE, </span><br><span class="line">lat1 DOUBLE, </span><br><span class="line">lon2 DOUBLE, </span><br><span class="line">lat2 DOUBLE </span><br><span class="line">) RETURNS double</span><br><span class="line">RETURN 6371 * acos( </span><br><span class="line">cos(radians(lat1)) * cos(radians(lat2)) * cos( </span><br><span class="line">radians(lon2) - radians(lon1) </span><br><span class="line">) + sin(radians(lat1)) * sin(radians(lat2)) </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
        
      </div>
    </div>

    

  </div>

  <footer class="article-footer">
    <div class="article-more-info">
      <div class="article-date">
  <time datetime="2019-04-15T02:58:28.000Z" itemprop="datePublished">2019-04-15</time>
</div>
      
        <div class="article-category">
          <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
        </div>
      
      
        <div class="article-tag">
          <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>
        </div>
      
    </div>
  </footer>

</article>

    
  
    
      <article
  id="post-动态控制多层for循环嵌套"
  class="article article-type-post"
>

  

  <div class="article-inner">
    

    <div class="article-body">
      <header class="article-title">
        <a href="/p/5bd3.html">动态控制多层for循环嵌套</a>
      </header>
      <div class="article-entry post-inner-html">
        
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fukaiit/article/details/82730537">参考链接</a></p>
</blockquote>
<p>有些场景我们解多元一次方程时，如果方程组不够，就需要通过枚举求解，比如<code>2x+3y+4z=10</code>,需要3层for循环求解，但如果元数未知，枚举时则需要动态控制for循环的深度，我们可以通过递归解决这个问题，大概思路如下</p>
<ul>
<li>首先通过二维数组枚举所有可能的值</li>
<li>递归遍历二维数组控制for循环的层数</li>
<li>递归到最后一层时判断控制是否满足方程的条件，打印输出<h1 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h1>根据红包的总额，红包的总份数及每个红包的金额种类，得到每个红包金额对应的份数<h1 id="代码及注释"><a href="#代码及注释" class="headerlink" title="代码及注释"></a>代码及注释</h1>github: <a target="_blank" rel="noopener" href="https://github.com/WhenCoding/calcRedPackage">https://github.com/WhenCoding/calcRedPackage</a></li>
</ul>

        
      </div>
    </div>

    

  </div>

  <footer class="article-footer">
    <div class="article-more-info">
      <div class="article-date">
  <time datetime="2019-04-12T02:50:43.000Z" itemprop="datePublished">2019-04-12</time>
</div>
      
        <div class="article-category">
          <a class="article-category-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91/">日常开发</a>
        </div>
      
      
        <div class="article-tag">
          <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
        </div>
      
    </div>
  </footer>

</article>

    
  
    
      <article
  id="post-springboot-redis-cache"
  class="article article-type-post"
>

  

  <div class="article-inner">
    

    <div class="article-body">
      <header class="article-title">
        <a href="/p/3388.html">springboot 2.x集成redis作为cache</a>
      </header>
      <div class="article-entry post-inner-html">
        
          <blockquote>
<p>参考自 <a target="_blank" rel="noopener" href="https://blog.csdn.net/sy793314598/article/details/80719224">springbot2.x整合redis做缓存</a></p>
</blockquote>
<h1 id="redis的相关配置"><a href="#redis的相关配置" class="headerlink" title="redis的相关配置"></a>redis的相关配置</h1><h2 id="引入相关依赖"><a href="#引入相关依赖" class="headerlink" title="引入相关依赖"></a>引入相关依赖</h2><p>首先使用maven引入spring-redis相关的依赖，2.0中使用spring-boot-starter-data-redis代替了原来的spring-boot-starter-redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="配置redis数据库"><a href="#配置redis数据库" class="headerlink" title="配置redis数据库"></a>配置redis数据库</h2><p>在SpringBoot的application.yml配置文件中配置redis数据库的相关信息，这里改动主要有两点，其一是时间相关的属性，如spring.redis.timeout，在1.0中，时间相关的配置参数类型为int，默认单位为毫秒，配置中只需指定具体的数字即可，而在2.0中，时间相关的配置的参数类型都改为了jdk1.8的Duration，因此在配置文件中配置redis的连接超时时间timeout时，需要加入时间单位，如60s；其二是，在2.0中配置redis的连接池信息时，不再使用spring.redis.pool的属性，而是直接使用redis的lettuce或jedis客户端来配置，具体配置信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: 127.0.0.1</span><br><span class="line">    password: gitlab</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 10</span><br><span class="line">    timeout: 3s  # 数据库连接超时时间，2.0 中该参数的类型为Duration，这里在配置的时候需要指明单位</span><br><span class="line">    # 连接池配置，2.0中直接使用*jedis*或者lettuce配置连接池</span><br><span class="line">    jedis:</span><br><span class="line">      pool:</span><br><span class="line">        # 最大空闲连接数</span><br><span class="line">        max-idle: 500</span><br><span class="line">        # 最小空闲连接数</span><br><span class="line">        min-idle: 50</span><br><span class="line">        # 等待可用连接的最大时间，负数为不限制</span><br><span class="line">        max-wait:  -1s</span><br><span class="line">        # 最大活跃连接数，负数为不限制</span><br><span class="line">        max-active: -1</span><br></pre></td></tr></table></figure>
<h2 id="配置CacheManager"><a href="#配置CacheManager" class="headerlink" title="配置CacheManager"></a>配置CacheManager</h2><p>通过配置Spring的CacheManager为redis，即可指定使用redis做缓存，具体的配置方式跟1.0也有所不同，在1.0中使用RedisTemplate即可实例化一个RedisCacheManager：RedisCacheManager cacheManager = new RedisCacheManager(redisTemplate);，在2.0中删除了这个构造器，同时也不可以通过之前的setDefaultExpiration方法设置默认的缓存过期时间等，在新版本中可以通过以下的两种方式构造一个RedisCacheManager：</p>
<h3 id="通过RedisCacheManager的静态方法create"><a href="#通过RedisCacheManager的静态方法create" class="headerlink" title="通过RedisCacheManager的静态方法create"></a>通过RedisCacheManager的静态方法create</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public CacheManager cacheManager(RedisConnectionFactory factory) &#123;</span><br><span class="line">    RedisCacheManager cacheManager &#x3D; RedisCacheManager.create(factory);</span><br><span class="line">    return cacheManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样产生的cacheManager只是使用Spring提供的默认配置</p>
<h3 id="通过Spring提供的RedisCacheConfiguration类，构造一个自己的redis配置类，从该配置类中可以设置一些初始化的缓存命名空间、及对应的默认过期时间等属性，再利用RedisCacheManager中的builder-build-的方式生成cacheManager："><a href="#通过Spring提供的RedisCacheConfiguration类，构造一个自己的redis配置类，从该配置类中可以设置一些初始化的缓存命名空间、及对应的默认过期时间等属性，再利用RedisCacheManager中的builder-build-的方式生成cacheManager：" class="headerlink" title="通过Spring提供的RedisCacheConfiguration类，构造一个自己的redis配置类，从该配置类中可以设置一些初始化的缓存命名空间、及对应的默认过期时间等属性，再利用RedisCacheManager中的builder.build()的方式生成cacheManager："></a>通过Spring提供的RedisCacheConfiguration类，构造一个自己的redis配置类，从该配置类中可以设置一些初始化的缓存命名空间、及对应的默认过期时间等属性，再利用RedisCacheManager中的builder.build()的方式生成cacheManager：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @ClassName RedisConfig class</span><br><span class="line"> * @Author xin</span><br><span class="line"> * @Date 2019-03-27</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@EnableCaching</span><br><span class="line">public class RedisConfig extends CachingConfigurerSupport &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public CacheManager cacheManager(RedisConnectionFactory factory) &#123;</span><br><span class="line">        RedisCacheConfiguration config &#x3D; RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(60))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line"></span><br><span class="line">        return RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .transactionAware()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="配置RedisTemplate，进行简单的key、value相关操作"><a href="#配置RedisTemplate，进行简单的key、value相关操作" class="headerlink" title="配置RedisTemplate，进行简单的key、value相关操作"></a>配置RedisTemplate，进行简单的key、value相关操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">    public RedisTemplate redisTemplate(RedisConnectionFactory factory) &#123;</span><br><span class="line">        StringRedisTemplate template &#x3D; new StringRedisTemplate(factory);</span><br><span class="line"></span><br><span class="line">        RedisSerializer keySerializer &#x3D; new StringRedisSerializer(); &#x2F;&#x2F; 设置key序列化类，否则key前面会多了一些乱码</span><br><span class="line">        template.setKeySerializer(keySerializer);</span><br><span class="line">        setValueSerializer(template);&#x2F;&#x2F;设置value序列化</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        template.setEnableTransactionSupport(true);</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setValueSerializer(StringRedisTemplate template) &#123;</span><br><span class="line">        @SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer &#x3D; new Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om &#x3D; new ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
        
      </div>
    </div>

    

  </div>

  <footer class="article-footer">
    <div class="article-more-info">
      <div class="article-date">
  <time datetime="2019-04-04T10:05:50.000Z" itemprop="datePublished">2019-04-04</time>
</div>
      
        <div class="article-category">
          <a class="article-category-link" href="/categories/SpringBoot/">SpringBoot</a>
        </div>
      
      
        <div class="article-tag">
          <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li></ul>
        </div>
      
    </div>
  </footer>

</article>

    
  
    
      <article
  id="post-mysql-recover"
  class="article article-type-post"
>

  

  <div class="article-inner">
    

    <div class="article-body">
      <header class="article-title">
        <a href="/p/6ca7.html">mysql误删一张表</a>
      </header>
      <div class="article-entry post-inner-html">
        
          <blockquote>
<p>大家开发过程中，难免会存在误删数据库表的情况，可见，数据库的备份机制需要引起大家的重视，本文主要介绍一下，拥有备份文件（.frm 和 .ibd）的情况下，如何快速恢复该表。</p>
</blockquote>
<h1 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h1><p>作者使用的正式数据库是阿里云的rds，一天午后，使用navicat工具误操作删除了一张日志表，但幸运的是，设置了阿里云的备份机制。</p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><ul>
<li>首先从阿里云备份记录中下载最新的备份tar或者zip文件，然后解压会得到数据库中的文件，找到该日志表对应的.frm和.ibd。<br><a name="back"></a></li>
<li>查看被删除数据库版本和恢复至的数据库版本是否一致，如果一致请继续，如果不一致，请<a href='#fn1b'>查看下面</a>的版本不一致问题如何解决；</li>
<li>新建一个数据库（名称任意），在该数据库中新建一张表（名称与你要恢复的表名称相同），最好结构也有，数据无所谓，引擎必须是innode，然后删除新建的表空间: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 删除该表的.idb</span><br><span class="line">ALTER TABLE table_name DISCARD TABLESPACE;</span><br></pre></td></tr></table></figure></li>
<li>再将该表对应的 .ibd 备份文件替换新表的.ibd文件（/var/lib/mysql/test  这是test数据库的文件目录），执行如下命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 修改权限</span><br><span class="line">chown mysql:mysql tablename.ibd</span><br></pre></td></tr></table></figure></li>
<li>重新导入表空间  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &lt;table name&gt; import tablespace;</span><br></pre></td></tr></table></figure>
<a name='fn1b'></a><br>这一步可能出现版本问题，因为之前版本的数据库是5.6，新的数据库是5.7<ul>
<li>版本的解决办法<br><img src="/images/mysql/version_wrong.png" alt="pic"><br>究其原因是从MySQL5.7版本中innodb_file_format参数（该参数表示innodb文件格式）的默认值发生了变化，在MySQL5.7以前innodb_file_format参数默认是Antelope，而默认的行格式是（ROW_FORMAT）是COMPACT，从MySQL5.7以后版本innodb_file_format默认值为Barracuda，默认的行格式是（ROW_FORMAT）是DYNAMIC，所以需要在创建表结构时指定row_format=compact<br>因此我们需要重新建一张表</li>
</ul>
</li>
</ul>
<ol>
<li>在新库中删除对应的表，并删除新库中存在的数据文件（/var/lib/mysql/test）；</li>
<li>创建新的表结构并指定行格式为compact。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tablename&#96; (</span><br><span class="line">  ...</span><br><span class="line">) ROW_FORMAT&#x3D;COMPACT</span><br></pre></td></tr></table></figure>
之后的步骤<a href="#back">继续执行上面的步骤</a></li>
</ol>

        
      </div>
    </div>

    

  </div>

  <footer class="article-footer">
    <div class="article-more-info">
      <div class="article-date">
  <time datetime="2019-03-28T12:56:45.000Z" itemprop="datePublished">2019-03-28</time>
</div>
      
        <div class="article-category">
          <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
        </div>
      
      
        <div class="article-tag">
          <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>
        </div>
      
    </div>
  </footer>

</article>

    
  
    
      <article
  id="post-vue-cli-axios-springboot-实现文件下载"
  class="article article-type-post"
>

  

  <div class="article-inner">
    

    <div class="article-body">
      <header class="article-title">
        <a href="/p/2366.html">vue cli + axios + springboot 实现文件下载</a>
      </header>
      <div class="article-entry post-inner-html">
        
          <h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="install-axios"><a href="#install-axios" class="headerlink" title="install axios"></a>install axios</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cnpm install axios --save</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &#39;axios&#39;;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h2><p>执行的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">downLoadMix() &#123;  </span><br><span class="line">  let params &#x3D; &#123;&#125;;</span><br><span class="line">  let url &#x3D; this.$store.state.urlPrefix+&quot;&#x2F;company&#x2F;download&quot;;</span><br><span class="line">  let title &#x3D; null;</span><br><span class="line">    axios(&#123;  </span><br><span class="line">    method: &#39;post&#39;, </span><br><span class="line">    url,  </span><br><span class="line">    headers: &#123;  </span><br><span class="line">    &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    data: params,  </span><br><span class="line">    responseType: &#39;arraybuffer&#39;  </span><br><span class="line">    &#125;).then(res &#x3D;&gt; &#123;  </span><br><span class="line">        let headers &#x3D; res.headers;  &#x2F;&#x2F;后端需要配置Access-Control-Expose-Headers,否则浏览器只能访问到默认的响应头,具体如下</span><br><span class="line">        let blob &#x3D; new Blob([res.data], &#123;  </span><br><span class="line">          type: headers[&#39;content-type&#39;]  </span><br><span class="line">        &#125;);  </span><br><span class="line">        let link &#x3D; document.createElement(&#39;a&#39;);  </span><br><span class="line">        link.href &#x3D; window.URL.createObjectURL(blob);  </span><br><span class="line">        if (!title) &#123;  </span><br><span class="line">          const fileName &#x3D; headers[&#39;content-disposition&#39;];  </span><br><span class="line">          title &#x3D; fileName.includes(&#39;filename&#x3D;&#39;) ? fileName.split(&#39;&#x3D;&#39;)[1] : &#39;下载的表单文件&#39;;  </span><br><span class="line">        &#125;  </span><br><span class="line">        link.download &#x3D; title;  </span><br><span class="line">        link.click();  </span><br><span class="line">    &#125;);  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="后端代码-解决axios获取Http响应头"><a href="#后端代码-解决axios获取Http响应头" class="headerlink" title="后端代码(解决axios获取Http响应头)"></a>后端代码(解决axios获取Http响应头)</h2><p>浏览器默认只能访问以下响应头</p>
<ul>
<li>Cache-Control</li>
<li>Content-Language</li>
<li>Content-Type</li>
<li>Expires</li>
<li>Last-Modified</li>
<li>Pragma</li>
</ul>
<p>因此如果想让浏览器能访问到其他响应头内容的话，比如<code>Content-disposition</code>,需要在服务器上设置 <code>Access-Control-Expose-Headers</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;Access-Control-Expose-Headers&quot;,&quot;Content-disposition&quot;);</span><br></pre></td></tr></table></figure>
<p>或者完全放开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;Access-Control-Expose-Headers&quot;,&quot;*&quot;);</span><br></pre></td></tr></table></figure>
<p>即可允许浏览器访问任意一个响应头，当然除次之外还要设置下载文件相关的响应头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(&quot;application&#x2F;octet-stream&quot;);</span><br><span class="line">response.setHeader(&quot;Content-disposition&quot;, &quot;attachment;filename&#x3D;createList.xls&quot;);&#x2F;&#x2F;默认Excel名称</span><br></pre></td></tr></table></figure>
<p>后端i/o流照常处理，例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value &#x3D; &quot;&#x2F;download&quot;, method &#x3D; &#123;RequestMethod.POST&#125;, produces &#x3D; &#123;&quot;application&#x2F;json;charset&#x3D;UTF-8&quot;&#125;)</span><br><span class="line">public void download(@RequestBody RequestFacade request, HttpServletResponse response) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        &#x2F;&#x2F;创建工作簿</span><br><span class="line">        XSSFWorkbook wb &#x3D; new XSSFWorkbook();</span><br><span class="line">        &#x2F;&#x2F;创建一个sheet</span><br><span class="line">        XSSFSheet sheet &#x3D; wb.createSheet();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 创建单元格样式</span><br><span class="line">        XSSFCellStyle style &#x3D; wb.createCellStyle();</span><br><span class="line">        style.setFillForegroundColor(HSSFColor.WHITE.index);</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        response.setContentType(&quot;application&#x2F;octet-stream&quot;);</span><br><span class="line">        response.setHeader(&quot;Content-disposition&quot;, &quot;attachment;filename&#x3D;createList.xls&quot;);&#x2F;&#x2F;默认Excel名称</span><br><span class="line">        response.setHeader(&quot;Access-Control-Expose-Headers&quot;,&quot;*&quot;);</span><br><span class="line">        response.flushBuffer();</span><br><span class="line">        wb.write(response.getOutputStream());</span><br><span class="line">    &#125;catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



        
      </div>
    </div>

    

  </div>

  <footer class="article-footer">
    <div class="article-more-info">
      <div class="article-date">
  <time datetime="2019-03-08T09:36:09.000Z" itemprop="datePublished">2019-03-08</time>
</div>
      
        <div class="article-category">
          <a class="article-category-link" href="/categories/SpringBoot/">SpringBoot</a>
        </div>
      
      
        <div class="article-tag">
          <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>
        </div>
      
    </div>
  </footer>

</article>

    
  

  
    <nav class="pagination">
        <a class="extend prev" rel="prev" href="/page/11/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/13/">Next</a>
    </nav>
  
</div>

                </section>
            </section>

             
            <aside class="sidebar">
            
                


<div class="widget" id="widget">
    
      
    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jenkins/">Jenkins</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mybatis/">Mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/">个人成长</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91/">日常开发</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91/%E5%BE%AE%E4%BF%A1/">微信</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/">系统运维</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Freemarker/" rel="tag">Freemarker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Selenium/" rel="tag">Selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cdn/" rel="tag">cdn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/email/" rel="tag">email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exception/" rel="tag">exception</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/" rel="tag">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mq/" rel="tag">mq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag">建站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/" rel="tag">微信公众号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%AF%E4%BB%98/" rel="tag">支付</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/p/21452.html">「Elasticsearch」SpringBoot快速集成ES</a>
          </li>
        
          <li>
            <a href="/p/35755.html">Linux服务器的晴雨表——top命令</a>
          </li>
        
          <li>
            <a href="/p/62773.html">通过shell脚本一键安装python3</a>
          </li>
        
          <li>
            <a href="/p/8425.html">如何使用Freemarker生成Word文件</a>
          </li>
        
          <li>
            <a href="/p/38722.html">解决SpringBoot jar包中的文件读取问题</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">2018</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <div class="footer-wrap">
        <div class="footer-inner"> 
            程序员小明 | Java | Spring Boot | Spring Cloud | ElasticSearch |日常开发 |最新干货分享 &copy; 2020<br>
            Powered By Hexo · Theme By <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Aomori</a>
        </div>
    </div>

</footer>




<script src="/dist/build.js?1.13.0.js"></script>


<script src="/dist/custom.js?1.13.0.js"></script>









</body>

</html>